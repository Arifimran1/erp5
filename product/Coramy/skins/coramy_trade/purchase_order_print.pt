<HTML>
  <HEAD>
    <meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
    <title tal:content="here/getTitle">Coramy</title>
    <link rel=stylesheet type="text/css" href="mesure">
  </HEAD>

  <BODY tal:define="commercial python:here.getSourceAdministrationValue(portal_type=['Person']);
                      gestionaire python:here.getDestinationAdministrationValue(portal_type=['Person']);
                      fournisseur python:here.getSourceValue(portal_type=['Organisation']);
                      livraison python:here.getDestinationValue(portal_type=
                      ['Organisation','Category']);
                      totalizer python:[0];
                      order_lines_list python:here.contentValues(filter={'portal_type':
                      'Purchase Order Line'})">

  <TABLE width="660" height="900"  cellpadding="0" cellspacing="0"><!-- Tableau general -->
    <TR>
      <TD>
        <TABLE border="0" width="100%" height="100%">
          <TR>
            <TD>
              <h2>Coramy</h2>
            </TD>
            <TD align="center">
              <h2>Commande <span tal:content="python:here.getOrderType()+' n° '+here.getId()"/></h2>
            </TD>
            <TD align="right">
              <span tal:content="python:'Emise le : '+str(here.getDateEmission())"/>
            </TD>
          </TR>
        </TABLE>
      </TD>
    </TR>

    <TR><!-- Espacement inter-tableaux -->
      <TD height="15"/>
    </TR>

    <TR height="10%"><!-- Infos -->
      <TD>
        <TABLE border="0" width="100%" height="100%">
          <TR>
            <TD class="bold">Livrer à</TD>
            <TD nowrap>
              <SPAN tal:condition="python:livraison<>None">
                <b><SPAN tal:content="python:modules['string'].capwords(livraison.getTitle())"/></b>
                <br><SPAN tal:condition="python:livraison.getPortalType()<>'Category'">
                      <SPAN tal:define="address_items python:modules['string'].
                          split(livraison.getDefaultAddress().asText(country='France'),'\n')">
                        <SPAN tal:repeat="item address_items">
                          <SPAN tal:content="item"/><br>
                        </SPAN>
                      </SPAN>
                    </SPAN>
              </SPAN>
            </TD>
            <TD width="100%">&nbsp;</TD>
            <TD class="bold">Fournisseur</TD>
            <TD nowrap>
              <SPAN tal:condition="python:fournisseur<>None">
                <b><SPAN tal:content="python:modules['string'].capwords(fournisseur.getTitle())"/></b>
                <br><SPAN tal:define="address_items python:modules['string'].split(fournisseur.getDefaultAddress().asText(country='France'),'\n')">
                    <SPAN tal:repeat="item address_items">
                      <SPAN tal:content="item"/><br>                  
                    </SPAN>
                    </SPAN>
              </SPAN>
            </TD>
          </TR>
          <TR>
            <TD class="bold">Gestionaire</TD>
            <TD>
              <SPAN tal:condition="python:gestionaire<>None">
                <SPAN tal:content="python: modules['string'].capwords(gestionaire.getTitle())">
                </SPAN>
              </SPAN>
            </TD>
            <TD ></TD>
            <TD nowrap class="bold">A l'attention de&nbsp;</TD>
            <TD>
              <SPAN tal:condition="python:commercial<>None">
                <SPAN tal:content="python: modules['string'].capwords(commercial.getTitle())">
                </SPAN>
              </SPAN>
            </TD>
          </TR>
          <TR>
            <TD class="bold">Téléphone</TD>
            <TD>
              <SPAN tal:condition="python:gestionaire<>None">
                <SPAN tal:content="python:gestionaire.getDefaultTelephoneText()">
                </SPAN>
              </SPAN>
            </TD>
            <TD ></TD>
            <TD nowrap class="bold">Téléphone</TD>
            <TD>
              <SPAN tal:condition="python:commercial<>None">
                <SPAN tal:content="python:commercial.getDefaultTelephoneText()">
                </SPAN>
              </SPAN>
            </TD>
          </TR>
          <TR>
            <TD class="bold">Fax</TD>
            <TD>
              <SPAN tal:condition="python:gestionaire<>None">
                <SPAN tal:content="python:gestionaire.getDefaultFaxText()">
                </SPAN>
              </SPAN>
            </TD>
            <TD ></TD>
            <TD nowrap class="bold">Fax</TD>
            <TD>
              <SPAN tal:condition="python:commercial<>None">
                <SPAN tal:content="python:commercial.getDefaultFaxText()">
                </SPAN>
              </SPAN>
            </TD>
          </TR>
        </TABLE>
      </TD>
    </TR>


    <TR><!-- Espacement inter-tableaux -->
      <TD height="15"/>
    </TR>

    <TR><!-- Tableau de lignes de commande -->
      <TD valign="top">
        <TABLE border="2" width="100%">
          <TR>
            <TD class="bold" align="center">Référence Fournisseur</TD>
            <TD class="bold" align="center">Code interne</TD>
            <TD class="bold" align="center" width="100%">Désignation</TD>
            <TD class="bold" align="center">Variantes</TD>
            <TD class="bold" align="center">Quantité</TD>
            <TD class="bold" align="center">Unité</TD>
            <TD class="bold" align="center">Prix unitaire</TD>
            <TD class="bold" align="center">Prix total</TD>
            <TD class="bold" align="center">Date livraison</TD>
          </TR>
          <SPAN tal:repeat="order_line order_lines_list">
            <SPAN tal:define="delivery_cell_list python:order_line.getDeliveryCellPrintList()">
              <TR tal:repeat="delivery_cell delivery_cell_list">
                <TD nowrap tal:content="python:delivery_cell[0]" align="left"></TD>
                <TD tal:content="python:delivery_cell[1]" align="left"></TD>
                <TD tal:content="python:delivery_cell[2]" align="left"></TD>
                <TD nowrap tal:define="variantes_list python:delivery_cell[3]" align="left">
                  <SPAN tal:repeat="variante variantes_list">
                    <SPAN tal:condition="python:variante<>'value' and variante<>None">
                      <SPAN tal:define="variante_items python:variante.split('/')">
                        <SPAN tal:content="python:variante_items[len(variante_items)-1]"/><BR>
                      </SPAN>
                    </SPAN>
                  </SPAN>
                </TD>
                <TD tal:content="python: '%.0f' % delivery_cell[4]" align="right"></TD>
                <TD tal:content="python:delivery_cell[5]" align="left"></TD>
                <TD tal:content="python: '%.3f' % delivery_cell[6]" align="right"></TD>
                <TD tal:content="python: '%.2f' % delivery_cell[7]" align="right"></TD>
                <TD tal:content="python:delivery_cell[8]" align="center"></TD>
                  <SPAN tal:define="toto python:order_line.PT_update_total_list(totalizer,[0],delivery_cell[7])"/>
              </TR>
            </SPAN>
          </SPAN>
          <TR>
            <TD colspan="7" align="right">Total
            </TD>
            <TD tal:content="python: '%.2f' %totalizer[0]"/>
            <TD>
            <SPAN tal:define="currency_items python:here.getPriceCurrency().split('/')">
              <SPAN tal:content="python:currency_items[len(currency_items)-1]"/>
            </SPAN>
            </TD>
          </TR>
        </TABLE>
      </TD>
    </TR>

    <TR tal:define="commentaires_list python:modules['string'].split(here.getComment(''),'\n')"><!-- Notes -->
      <TD valign="top">
          <span tal:repeat="commentaires_item commentaires_list">
          <br>
          <span tal:content="python:commentaires_item"/></span>
      </TD>
    </TR>

    <TR><!-- Espacement inter-tableaux -->
      <TD height="15"/>
    </TR>

    <TR>
      <TD height="90%"/>
    </TR>
    <TR>
      <TD align="center">Coramy - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 91 51 -  Fax : + 33 (0) 3 28 23 34 96
        <p class="Copy">S.A.S. au capital de 435.200 € - T.V.A. FR 67 611 750 274 - R.C. Dunkerque 611 750 274 - SIRET 611 750 274 00023  - CNUF 15971</p>
      </TD>
    </TR>
  </TABLE>
  </BODY>
</HTML>
