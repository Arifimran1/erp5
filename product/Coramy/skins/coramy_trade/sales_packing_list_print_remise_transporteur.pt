<HTML>
  <HEAD>
    <meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
    <title tal:content="here/getTitle">Coramy</title>
    <link rel=stylesheet type="text/css" href="modele_catalog_c">
  </HEAD>
  <BODY bgcolor="#ffffff" tal:define="delivery_dict python:here.SalesPackingList_buildRemiseTransporteurDict();
                                       page_number python:[0]">
    <SPAN tal:repeat="societe python:delivery_dict.keys()">
    <SPAN tal:repeat="transporteur python:delivery_dict[societe].keys()"
    tal:define="totalizer python:[0,0,0,0]">

      <TABLE border="0" width="660" height="900"  cellpadding="0" cellspacing="0"
              tal:define="transporteur_items python:transporteur.split('/');
                        pretty_transporteur python:transporteur_items[len(transporteur_items)-1]"><!-- Tableau general -->
        <TR>
          <TD>
            <TABLE border="0" width="100%" height="100%">
              <TR>
                <TD class="Titre" tal:content="societe">Coramy</TD>
                <TD align="center">
                  <span class="Titre2">Remise de colis à <span tal:content="pretty_transporteur"/></span>
                </TD>
                <TD align="right">
                  <span tal:content="python:'Gravelines, le '+str(here.DateTime_getFormattedDate())"/>
                </TD>
              </TR>
            </TABLE>
          </TD>
        </TR>
        <TR height="18%"><!-- Infos -->
          <TD><br>
            <TABLE border="1" width="100%" height="100%">
              <TR>
                <TD>Destinataire
                </TD>
                <TD nowrap>No Livraison
                </TD>
                <TD nowrap>No Commande client
                </TD>
                <TD>Nb Colis
                </TD>
                <TD>Poids (kg)
                </TD>
              </TR>
              <SPAN tal:repeat="destination_organisation python:delivery_dict[societe][transporteur].keys()" width="660" height="955"  cellpadding="0" cellspacing="0" tal:attributes="class python:here.PT_pageBreak(page_number)">
              <TR>
              <SPAN tal:define="destination python:here.restrictedTraverse(destination_organisation);
              toto python:here.PT_reset_total_list(totalizer,[1,3])">
                <TD valign="top" tal:attributes="rowspan python:len(delivery_dict[societe][transporteur][destination_organisation])+2">
                 <SPAN tal:condition="python:destination<>None">
                  <b><SPAN tal:content="python:modules['string'].capwords(destination.getTitle())"/></b>
                  <br><SPAN tal:condition="python:destination.getPortalType()<>'Category'">
                      <SPAN tal:define="address_items python:modules['string'].
                              split(destination.getDefaultAddress().asText(country='France'),'\n')">
                        <SPAN tal:repeat="item address_items">
                          <SPAN tal:content="item"/><br>
                        </SPAN>
                      </SPAN>
                    </SPAN>
                  </SPAN>
                </TD>
              </SPAN>
              </TR>
              <SPAN tal:repeat="delivery python:delivery_dict[societe][transporteur][destination_organisation]">
                <TR><!-- Détail des livraisons -->
                 <TD tal:content="python:delivery.getId()">
                 </TD>
                 <TD tal:define="order python:delivery.getCausalityValue(portal_type=['Sales Order'])">
                   <SPAN tal:content="python:order.getDestinationReference()"/>
                 </TD>
                 <TD align="right" tal:define="colis_nb python:len(delivery.contentValues(filter={'portal_type':'Container'}))">
                   <SPAN tal:define="toto python:delivery.PT_update_total_list(totalizer,[0,1],colis_nb)"/>
                   <SPAN tal:content="colis_nb"/>
                 </TD>
                 <TD align="right" tal:define="weight python:delivery.PackingList_getTotalGrossWeight()">
                   <SPAN tal:define="toto python:delivery.PT_update_total_list(totalizer,[2,3],weight)"/>
                   <SPAN tal:content="python:'%.1f' %weight"/>
                 </TD>
                </TR>
              </SPAN>

                <TR> <!-- Totaux par destinataire -->
                  <TD align="right" colspan="2"><b>Sous-total</b>
                  </TD>
                  <TD align="right"><b>
                    <SPAN tal:content="python:totalizer[1]"/></b>
                  </TD>
                  <TD align="right"><b>
                    <SPAN tal:content="python:'%.1f' %totalizer[3]"/></b>
                  </TD>
                </TR>

              </SPAN>

                <TR> <!-- Totaux par transporteur -->
                  <TD align="right" colspan="3"><b>TOTAL</b>
                  </TD>
                  <TD align="right"><b>
                    <SPAN tal:content="python:totalizer[0]"/></b>
                  </TD>
                  <TD align="right"><b>
                    <SPAN tal:content="python:'%.1f' %totalizer[2]"/></b>
                  </TD>
                </TR>

                <TR>
                  <TD colspan="5">
                   <b><SPAN tal:content="python:'Je reconnais avoir pris en charge %s colis pour un poids approximatif de %s kg pour le compte de la société %s.' %(totalizer[0],totalizer[2],pretty_transporteur)"/></b><br>Le chauffeur
                  </TD>
                </TR>
            </TABLE>
          </TD>
        </TR>
        <TR>
          <TD tal:condition="python:societe=='BLS'" align="center">BLS - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 86 26 -  Fax : + 33 (0) 3 28 23 34 96
            <p class="Copy">S.A.R.L. au capital de 10.000 € - T.V.A. FR 51 442 959 243 - R.C. Dunkerque 442 959 243 - SIRET 442 959 243 00019</p>
          </TD>
          <TD tal:condition="python:societe=='Houvenaegel'" align="center">Houvenaegel Création - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 91 55 -  Fax : + 33 (0) 3 28 23 34 96
            <p class="Copy">S.A.R.L. au capital de 7.622,45 € - T.V.A. FR 07 422 769 810 - R.C. Dunkerque 422 769 810 - SIRET 422 769 810 00025</p>
          </TD>
          <TD tal:condition="python:societe=='Coramy'" align="center">Coramy - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 91 51 -  Fax : + 33 (0) 3 28 23 34 96
            <p class="Copy">S.A.S. au capital de 435.200 € - T.V.A. FR 67 611 750 274 - R.C. Dunkerque 611 750 274 - SIRET 611 750 274 00023  - CNUF 15971</p>
          </TD>
        </TR>
      </TABLE>
    </SPAN>
    </SPAN>
  </BODY>
</HTML>
