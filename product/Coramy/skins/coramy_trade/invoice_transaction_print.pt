<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

  <head>
    <meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
    <title tal:content="here/getTitle">Nexedi</title>

  </head>

  <body bgcolor="#ffffff"
                tal:define="packing_list_list python:here.getCausalityValueList(portal_type=['Sale Packing List','Sales Packing List']);
                from_organisation python:here.restrictedTraverse('organisation/nexedi');
                client_invoice python:here.getDefaultValue('destination_section',spec=['Organisation', 'Person']);
                client_delivery python:here.getDefaultValue('destination_section',spec=['Organisation', 'Person']);
                total_price python:here.getDefaultTotalPrice()">


  <table width=100%>
    <tr>
      <td colspan=3><img src="logo.png"></td>
    </tr>
    <tr>
      <td align=left tal:content="python: from_organisation.getCorporateName()" colspan="2" />
      <td align=right tal:content="python: 'Invoice Date: %s' % here.getStartDate()"/>
    </tr>
    <tr>
      <td align=left tal:content="python: 'Tel : %s' % from_organisation.getDefaultTelephone().asText()" colspan="2"/>
      <td align=right tal:content="python: 'Pay Before: %s' % here.getStopDate()"/>
    </tr>
    <tr>
      <td tal:content="python: from_organisation.getDefaultAddress().getStreetAddress()" colspan="2"/>
      <td align=right tal:content="python: 'Invoice N°Î: %s' % here.getId()"/>
    </tr>
    <tr>
      <td tal:content="python: '%s %s' %
                              (from_organisation.getDefaultAddress().getZipCode(),
                              from_organisation.getDefaultAddress().getCity())" colspan="3"/>
    </tr>

    <tr>
      <th colspan=3>
        <h2>INVOICE</h2>
      </th>
    </tr>

    </table>

    <br/>

      <table width=100%>
      <tr bgcolor=000000>
        <th align=left><font color=ffffff>INVOICE ADDRESS</th>
        <th align=left><font color=ffffff>DELIVERY ADDRESS</th>
      </tr>

      <tr>
        <td align=left tal:content="client_invoice/getCorporateName | client_invoice/getTitle"/>
        <td align=left tal:content="client_delivery/getCorporateName | client_delivery/getTitle"/>
      </tr>
      <tr>
        <td align=left tal:content="python: client_invoice.getDefaultAddress().getStreetAddress()"/>
        <td align=left tal:content="python: client_delivery.getDefaultAddress().getStreetAddress()"/>
      </tr>
      <tr>
        <td align=left tal:content="python: '%s %s' %
                              (client_invoice.getDefaultAddress().getZipCode(),
                                client_invoice.getDefaultAddress().getCity())"/>
        <td align=left tal:content="python: '%s %s' %
                              (client_delivery.getDefaultAddress().getZipCode(),
                                client_delivery.getDefaultAddress().getCity())"/>
      </tr>
      </table>

    <br/>

      <span tal:define="global movement_list python:[]" />
      <span tal:repeat="packing_list python:packing_list_list[0:2]">
        <span tal:define="dummy python:movement_list.extend(packing_list.getMovementList())" />
      </span>
      <span tal:define="group_list python: here.collectMovement(movement_list)"
            tal:repeat="group group_list">
        <table width='100%'>
          <tr bgcolor='#000000'>
            <th align=left nowrap><font color='#ffffff'>Title</font></th>
            <th align=left nowrap><font color='#ffffff'>Total Quantity</font></th>
            <th align=left nowrap><font color='#ffffff'>Total Price</font></th>
          </tr>
          <tr valign=top>
            <td align=left tal:content="python: group.getResourceTitle()"></td>
            <td align=left tal:content="python: '%.0f' % group.getTotalQuantity()"></td>
            <td align=left tal:content="python: '%.0f' % group.getTotalPrice()"></td>
          </tr>
        </table>
        <span tal:define="cell_range_list python:group.getMatrix().getCellRange()">
          <table width='80%'>
            <tr>
              <td>&nbsp;</td>
              <span tal:define="cell_x_range python:cell_range_list[0]"
                    tal:repeat="x cell_x_range">
                <td align=left tal:content="python:x"></td>
              </span>
            </tr>
            <span tal:define="cell_y_range python:cell_range_list[1]"
                  tal:repeat="y cell_y_range">
              <tr>
                <td align=left tal:content="python: y"></td>
                <span tal:define="cell_x_range python:cell_range_list[0]"
                      tal:repeat="x cell_x_range">
                  <td align=left><span tal:condition="python:group.getMatrix().getCell(x, y, base_id='cell') is not None">
                     <span tal:replace="python: '%.0f' % group.getMatrix().getCell(x, y, base_id='cell').getQuantity()"/></span></td>
                </span>
              </tr>
            </span>
          </table>
        </span>
      </span>
<!--
        <tr bgcolor=000000>
          <th align=left nowrap><font color=ffffff>N°Î</font></th>
          <th align=left nowrap><font color=ffffff>Description</font></th>
          <th nowrap><font color=ffffff>Quantity</th>
          <th nowrap><font color=ffffff>Unit</font></th>
          <th nowrap><font color=ffffff>Unit Price</font></th>
          <th nowrap><font color=ffffff>Total Price</font></th>
        </tr>
        <span tal:define="ordered_lines python:packing_list.contentValues(filter={'meta_type':'ERP5 Delivery Line'})"
              tal:repeat="ligne ordered_lines">
          <tr valign=top tal:condition="python:ligne.getQuantity()>0">

            <td align=left tal:content="python:ligne.getId()"></td>

            <td tal:content="python: ligne.getResourceTitle()"></td>
            <td align=right tal:content="python: '%.0f' % ligne.getQuantity()"></td>
            <td>n/a</td>
            <td align=right tal:content="python: '%.0f' % ligne.getPrice()"></td>
            <td align=right tal:content="python: '%.0f' % ligne.getTotalPrice()"></td>
          </tr>
        </span>
        <tr>
          <td colspan=6><hr noshade></td>
        </tr>
        <tr>
          <th colspan=4 align=right>Total</th>
          <td colspan=2 align=right tal:content="here/l1/getSourceCredit"></td>
        </tr>
        <tr>
          <th colspan=4 align=right>TVA 19.6 %</th>
          <td colspan=2 align=right tal:content="here/l2/getSourceCredit"></td>
        </tr>
        <tr>
          <td colspan=3>&nbsp;</td>
          <td colspan=3><hr noshade></td>
        </tr>
        <tr>
          <td colspan=3>A rè´±Áler dans <b>0</b> jours au plus tard.
    <br><font size="-3">Conditions de rè´±Álement: par chè´≤Òue, è´¢†0 jours date de la facture. Paiement acceptè´±†en euros.
    Tout retard de rè´≤Álement donnera lieu è´¢†une pè´±Óalitè´±†de 1,5% du montant dè´Â†par mois.
    Rè´±Ûerve de propriè´±Ùè´±∫ nous conservons la pleine propriè´±Ùè´±†des marchandises jusqu'au paiement intè´±Áral du prix, des taxes et accessoires.</font></td>

          <th colspan=1 align=right nowrap>Somme è´¢†rè´±Áler</th>
          <th colspan=2 align=right tal:content="here/l0/getSourceDebit"></th>
        </tr>
        <tr>
          <td>&nbsp;</td>
        </tr>
      </table>
-->
  <table width="100%">
  <tr>
        <td><center><h6>RCS Roubaix Tourcoing 440 047 504<br>
  Banque:&nbsp;30027&nbsp;Guichet:&nbsp;00039&nbsp;Compte:&nbsp;00000013323&nbsp;RIB:&nbsp;36<br>IBAN: FR76 3002 7175 3900 0410 2760 135<br>
  VAT FR72440047504</h6></center></td>
    </tr>
  </table>



</body>

</html>

