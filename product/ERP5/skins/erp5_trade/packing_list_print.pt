<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
		<title tal:content="here/getTitle">Nexedi</title>

	</head>

	<body bgcolor="#ffffff"
                tal:define="client_invoice python:here.getDefaultValue('destination',portal_type=['Organisation','Person']);
                client_delivery python:here.getDefaultValue('destination',portal_type=['Organisation','Person']);

from_organisation python:here.restrictedTraverse('/nexedi/organisation/nexedi');
                            order python:here.getDefaultValue('causality',portal_type=['Sale Order']);
                            buyer python:order.getDefaultValue('contact',portal_type=['Person']);
                            ordered_lines python:here.objectValues();
                            total_price python: here.getTotalPrice();
			    vat python: request.get('vat','0.196');
                            total_vat python: here.getTotalPrice() * float(vat)">


  <table width=100%>
  <tr>
    <td align=left tal:content="python: from_organisation.getTitle()"/>
    <td align=right tal:content="python: 'Tel : %s' % from_organisation.getDefaultTelephone().asText()"/>
  </tr>
  <tr>
    <td tal:content="python: from_organisation.getDefaultAddress().getStreetAddress()"/>
  </tr>
  <tr>
    <td tal:content="python: '%s %s' %
                             (from_organisation.getDefaultAddress().getZipCode(),
                             from_organisation.getDefaultAddress().getCity())"/>
  </tr>

  <tr>
    <th colspan=3>
      <h2>INVOICE</h2>
    </th>
  </tr>

  </table>

    <table width=100%>
    <tr>
      <td align=right tal:content="python: 'Invoice Date : %s' % here.getStartDate()"/>
    </tr>

    <tr>
      <td align=right tal:content="python: 'Pay Before : %s' % here.getTargetStartDate()"/>
    </tr>

    <tr>
      <td align=right tal:content="python: 'Invoice N° : %s' % here.getId()"/>
    </tr>

    <tr>
      <td>&nbsp;</td>
    </tr>
    </table>

    <table width=100%>
    <tr bgcolor=000000>
      <th align=left><font color=ffffff>INVOICE ADDRESS</th>
      <th align=left><font color=ffffff>DELIVERY ADDRESS</th>
    </tr>

    <tr>
      <td align=left tal:content="python: client_invoice.getTitle()"/>
      <td align=left tal:content="python: client_delivery.getTitle()"/>
    </tr>
    <tr>
      <td align=left tal:content="python: client_invoice.getDefaultAddress().getStreetAddress()"/>
      <td align=left tal:content="python: client_delivery.getDefaultAddress().getStreetAddress()"/>
    </tr>
    <tr>
      <td align=left tal:content="python: '%s %s' %
                             (client_invoice.getDefaultAddress().getZipCode(),
                             client_invoice.getDefaultAddress().getCity())"/>
      <td align=left tal:content="python: '%s %s' %
                             (client_delivery.getDefaultAddress().getZipCode(),
                             client_delivery.getDefaultAddress().getCity())"/>
    </tr>
    </table>

    <table width=100%>
    <tr bgcolor=000000>

     <th align=left><font color=ffffff>N°</th>
      <th align=left><font color=ffffff>Description</th>
      <th><font color=ffffff>Quantity</th>
      <th>&nbsp;</th>
      <th><font color=ffffff>Unit_Price</th>
      <th><font color=ffffff>Price</th>
    </tr>

    <span tal:repeat="ligne ordered_lines">
    <tr valign=top tal:condition="python:ligne.getQuantity()>0">

      <td align=left tal:content="python:ligne.getId()"></td>
<!--      <td> </td> -->
      <td tal:content="python: ligne.getResourceTitle()"></td>
      <td align=right tal:content="python: '%.0f' % ligne.getQuantity()"></td>
      <td>n/a</td>
      <td align=right tal:content="python: '%.0f' % ligne.getPrice()"></td>
      <td align=right
         tal:define="line_price python: float(float(ligne.getPrice())*float(ligne.getQuantity()));
             total_price python: total_price + line_price"
         tal:content="python: '%.0f' % line_price"></td>
    </tr>
    </span>


    <tr>
      <td colspan=6><hr noshade></td>
    </tr>

    <tr>
      <th colspan=4 align=right>Total</th>
      <td colspan=2 align=right tal:content="python: total_price"></td>
    </tr>

    <tr>
      <th colspan=4 align=right tal:content="python: 'TVA ' + str(vat) + ' %'"></th>
      <td colspan=2 align=right tal:content="python: total_vat"></td>
    </tr>


    <tr>
      <td colspan=3>&nbsp;</td>
      <td colspan=3><hr noshade></td>
    </tr>

    <tr>
      <td colspan=3>A régler dans <b>0</b> jours au plus tard.
<br><font size="-3">Conditions de réglement: par chèque, à 0 jours date de la facture. Paiement accepté en euros.
Tout retard de règlement donnera lieu à une pénalité de 1,5% du montant dû par mois.
Réserve de propriété: nous conservons la pleine propriété des marchandises jusqu'au paiement intégral du prix, des taxes et accessoires.</font></td>
      <th colspan=2 align=right>Total à payer</th>
      <th colspan=1 align=right tal:content="python: total_price + total_vat"></th>
    </tr>

    <tr>
      <td>&nbsp;</td>
    </tr>

    </table>

<table width="100%">
<tr>
       <td><center><h6>RCS Roubaix Tourcoing 440 047 504<br>
 Banque:&nbsp;30027&nbsp;Guichet:&nbsp;00039&nbsp;Compte:&nbsp;00000013323&nbsp;RIB:&nbsp;36<br>IBAN: FR76 3002 7175 3900 0410 2760 135<br>
VAT FR72440047504</h6></center></td>
</tr>
</table>



</body>

</html>