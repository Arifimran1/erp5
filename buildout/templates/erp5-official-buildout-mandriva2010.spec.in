
%define version ${:version}
%define name ${:name}
%define release ${:release}

# We do not actually use /usr/local/bin/python
%define _requires_exceptions /usr/local/bin/python

%define fullname %{name}-%{version}
%define installdir /opt/erp5/%{version}

Name: %{name}
Version: %{version}
Release: %mkrel %{release}
Summary: Open Source ERP Solution
URL: http://www.erp5.org
License: GPL
Vendor: Nexedi
Packager: Nicolas Dumazet <nicolas.dumazet@nexedi.com>
Group: Databases

${:dependencies}

BuildRoot: /opt/rpmbuild/%{fullname}-%{release}-root

%description
%{summary}

%prep
%{__rm} -rf %{installdir}
%{__mkdir_p} %{installdir}

%build
cd %{installdir}
svn co ${:svnpath} .
python bootstrap/bootstrap.py
bin/buildout

%install
%{__rm} -rf %{buildroot}
%{__mkdir_p} %{buildroot}
%{__cp} -ar --parents %{installdir} %{buildroot}
# cleanup .svn files
find %{buildroot} -name .svn -print0 | xargs -0 %{__rm} -rf

%files
%defattr(-, root, root, 0755)
%{installdir}

%clean
%{__rm} -rf %{buildroot} %{installdir}

