<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <tuple>
        <tuple>
          <string>Products.PythonScripts.PythonScript</string>
          <string>PythonScript</string>
        </tuple>
        <none/>
      </tuple>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>Python_magic</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>Script_magic</string> </key>
            <value> <int>3</int> </value>
        </item>
        <item>
            <key> <string>__ac_local_roles__</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_bind_names</string> </key>
            <value>
              <object>
                <klass>
                  <global name="NameAssignments" module="Shared.DC.Scripts.Bindings"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>_asgns</string> </key>
                        <value>
                          <dictionary>
                            <item>
                                <key> <string>name_container</string> </key>
                                <value> <string>container</string> </value>
                            </item>
                            <item>
                                <key> <string>name_context</string> </key>
                                <value> <string>context</string> </value>
                            </item>
                            <item>
                                <key> <string>name_m_self</string> </key>
                                <value> <string>script</string> </value>
                            </item>
                            <item>
                                <key> <string>name_subpath</string> </key>
                                <value> <string>traverse_subpath</string> </value>
                            </item>
                          </dictionary>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>_body</string> </key>
            <value> <string encoding="cdata"><![CDATA[

"""\n
  A script for exporting listbox\'s contents as RSS feed.\n
  It is called by Listbox_viewAsRSS listbox renderer, which queries the listbox\n
  and passes on column labels and listbox renderer lines. Returns a dict containing\n
  channel information (channel = context in which the form was called) and a list\n
  of items as a piece of xml (because we have to manipulate tag names).\n
\n
  The implementation is based on RSS 2.0 specification, in a somewhat simplified way \n
  (e.g. enclosure and source are not implemented, and every guid is a permalink).\n
\n
  User can limit number of entries by passing "max_articles" in the url (default is 30).\n
\n
  USAGE:\n
  The RSS skin is to be used to render a custom rss listbox, which must have columns\n
  with titles beginning with "rss_". It is highly recommended to have the following:\n
  - rss_title\n
  - rss_author\n
  - rss_description\n
  - rss_pubDate\n
  - rss_link\n
  The way an object is presented should be defined in the listbox - the RSS skin passes on\n
  what is in the listbox, as is. So you can produce your own description, author information\n
  or publication date. A partial exception to this rule is dates - RSS protocol requires\n
  it to be compliant to RFC822, so the skin takes care of it - you don\'t have to (and you\n
  shouldn\'t) format date in the listbox. But the way you draw or calculate the\n
  publication date is entirely up to you.\n
"""\n
\n
allowed_field_list = (\'title\', \'link\', \'description\', \'author\', \'category\', \'comments\', \'guid\', \'pubDate\')\n
\n
from Products.CMFCore.utils import getToolByName\n
request = context.REQUEST\n
\n
channel = context\n
feed_data = {}\n
\n
# channel information\n
feed_data[\'channel_info\'] = { \'title\': channel.Title(),\n
                            \'description\': channel.getProperty(\'description\'), # so that it works for portal object too\n
                            \'url\': channel.absolute_url() + \'/view\' }\n
\n
# figure out which column is which, by using column titles\n
rss_column_mapping = {}\n
for index, column_item in enumerate(label_list):\n
  column_header = column_item[1]\n
  if column_header.startswith(\'rss_\'):\n
    field_name = column_header[4:]\n
    if field_name in allowed_field_list:\n
      rss_column_mapping[field_name] = index\n
\n
items = []\n
\n
for line in line_list:\n
  column_item_list = line.getValueList()\n
  rss_item_dict = {}\n
  for header, index in rss_column_mapping.items():\n
    value_tuple = column_item_list[index]\n
    # the [0] is a raw value, the [1] is rendered; we want strings rendered (as unicode),\n
    # but other stuff (like int or DateTime) we want as they are\n
    if hasattr(value_tuple[0], \'lower\'):\n
      value = value_tuple[1]\n
    else:\n
      value = value_tuple[0]\n
    # format dates\n
    if hasattr(value, \'rfc822\'):\n
      value = value.rfc822()\n
    rss_item_dict[header] = value\n
  # build xml from dict (we have to do it here because we need to manipulate tag names\n
  rss_item_string = \'\'\n
  for k, v in rss_item_dict.items():\n
    rss_item_string += (\'<%s>%s</%s>\\n\' % (k,v or \'\',k))\n
  items.append(rss_item_string)\n
\n
feed_data[\'listItemInfos\'] = tuple(items)\n
\n
return feed_data\n


]]></string> </value>
        </item>
        <item>
            <key> <string>_code</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_filepath</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_params</string> </key>
            <value> <string>label_list, line_list</string> </value>
        </item>
        <item>
            <key> <string>errors</string> </key>
            <value>
              <tuple/>
            </value>
        </item>
        <item>
            <key> <string>func_code</string> </key>
            <value>
              <object>
                <klass>
                  <global name="FuncCode" module="Shared.DC.Scripts.Signature"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>co_argcount</string> </key>
                        <value> <int>2</int> </value>
                    </item>
                    <item>
                        <key> <string>co_varnames</string> </key>
                        <value>
                          <tuple>
                            <string>label_list</string>
                            <string>line_list</string>
                            <string>allowed_field_list</string>
                            <string>Products.CMFCore.utils</string>
                            <string>getToolByName</string>
                            <string>_getattr_</string>
                            <string>context</string>
                            <string>request</string>
                            <string>channel</string>
                            <string>feed_data</string>
                            <string>_write_</string>
                            <string>rss_column_mapping</string>
                            <string>_getiter_</string>
                            <string>enumerate</string>
                            <string>index</string>
                            <string>column_item</string>
                            <string>_getitem_</string>
                            <string>column_header</string>
                            <string>field_name</string>
                            <string>items</string>
                            <string>line</string>
                            <string>column_item_list</string>
                            <string>rss_item_dict</string>
                            <string>header</string>
                            <string>value_tuple</string>
                            <string>hasattr</string>
                            <string>value</string>
                            <string>rss_item_string</string>
                            <string>k</string>
                            <string>v</string>
                            <string>tuple</string>
                          </tuple>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>func_defaults</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>id</string> </key>
            <value> <string>Listbox_asRSS</string> </value>
        </item>
        <item>
            <key> <string>warnings</string> </key>
            <value>
              <tuple/>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
