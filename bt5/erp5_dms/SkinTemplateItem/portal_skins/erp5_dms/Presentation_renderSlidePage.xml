<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <global name="PythonScript" module="Products.PythonScripts.PythonScript"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>Script_magic</string> </key>
            <value> <int>3</int> </value>
        </item>
        <item>
            <key> <string>_bind_names</string> </key>
            <value>
              <object>
                <klass>
                  <global name="NameAssignments" module="Shared.DC.Scripts.Bindings"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>_asgns</string> </key>
                        <value>
                          <dictionary>
                            <item>
                                <key> <string>name_container</string> </key>
                                <value> <string>container</string> </value>
                            </item>
                            <item>
                                <key> <string>name_context</string> </key>
                                <value> <string>context</string> </value>
                            </item>
                            <item>
                                <key> <string>name_m_self</string> </key>
                                <value> <string>script</string> </value>
                            </item>
                            <item>
                                <key> <string>name_subpath</string> </key>
                                <value> <string>traverse_subpath</string> </value>
                            </item>
                          </dictionary>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>_body</string> </key>
            <value> <string encoding="cdata"><![CDATA[

from json import dumps\n
\n
absolute_url = "%s" % context.absolute_url()\n
\n
return """\n
\n
var slide_current_page=""\n
var slide_current_page_number=0\n
var current_page_is_img=true\n
var slide_total_number=0\n
img_file_name_list=[]\n
text_file_name_list=[]\n
\n
function getTextFileNameList(file_name_list){\n
  var text_list=[];\n
  for (var i=0; i<file_name_list.length; i++) {\n
    if(file_name_list[i].indexOf("text")!=-1)\n
      text_list.push(file_name_list[i]);\n
  }\n
  text_list.sort();\n
  return text_list;\n
}\n
\n
function getFileNameList(){\n
  var file_name_list=[];\n
  $.ajax({\n
    url: %(absolute_url)s+"/"+"getPresentationFileNameList",\n
    type: \'get\',\n
    async: false,\n
    success: function(data) {\n
      file_name_list=$.parseJSON(data);\n
    } \n
  });\n
  return file_name_list;\n
}\n
\n
function getImgFileNameList(file_name_list){\n
  var img_list=[];\n
  var img_list_without_first=[];\n
  var img_first=[];\n
  for (var i=0; i<file_name_list.length; i++) {\n
    if(file_name_list[i].indexOf(".impr.")!=-1)\n
      img_first.push(file_name_list[i]);    \n
    else if(file_name_list[i].indexOf("img")!=-1)\n
      img_list_without_first.push(file_name_list[i]);\n
  }\n
  img_list_without_first.sort();\n
  img_list=img_first.concat(img_list_without_first)\n
  return img_list;\n
}\n
\n
function goToNewSlide(relative_path){\n
  slide_current_page=relative_path;\n
  for (var j=0; j<img_file_name_list.length; j++) {\n
    if (img_file_name_list[j].match(slide_current_page)){\n
      slide_current_page_number=j;\n
      current_page_is_img=true; \n
    }\n
  }\n
  for (var j=0; j<text_file_name_list.length; j++) {\n
    if (text_file_name_list[j].match(slide_current_page)){\n
      slide_current_page_number=j;\n
      current_page_is_img=false; \n
    }\n
  }\n
  $.ajax({\n
    url: %(absolute_url)s+"/"+relative_path,\n
    type: \'get\',\n
    async: false,\n
    success: function(data) {\n
      $(\'#slide_content\').html(data);\n
    } \n
  });\n
  renderNavigation();\n
  deleteTheDefaultNavigation();\n
  $("#slide_selection_index").val(slide_current_page_number+1);\n
}\n
\n
function deleteTheDefaultNavigation(){\n
  if(slide_current_page_number!=0 && slide_current_page_number+1!=slide_total_number)\n
    for(var i=1;i<11;i++)\n
      $("#slide_content").contents().get(1).remove();\n
  else\n
    for(var i=1;i<7;i++)\n
      $("#slide_content").contents().get(1).remove();\n
}\n
\n
function hideOneNavigation(nav_id,nav_img_id,nav_img_class){\n
  $("#"+nav_id).attr("onclick","");\n
  $("#"+nav_id).css("cursor","default")\n
  $("#"+nav_img_id).attr("class",nav_img_class);\n
}\n
\n
function resetOneNavigation(nav_id,nav_img_id,nav_img_class,new_href){\n
  $("#"+nav_id).attr("onclick","goToNewSlide(\'"+new_href+"\')");\n
  $("#"+nav_id).css("cursor","pointer")\n
  $("#"+nav_img_id).attr("class",nav_img_class);\n
}\n
\n
function renderNavigation(){\n
  if(slide_current_page_number==0){\n
    hideOneNavigation("first_slide","first_slide_img","first shaded")\n
    hideOneNavigation("previous_slide","previous_slide_img","previous shaded")\n
    if(current_page_is_img){\n
      resetOneNavigation("next_slide","next_slide_img","next",img_file_name_list[slide_current_page_number+1])\n
      resetOneNavigation("last_slide","last_slide_img","last",img_file_name_list[slide_total_number-1])\n
      resetOneNavigation("text_slide","text_slide_img","text",text_file_name_list[slide_current_page_number])\n
      hideOneNavigation("graphics_slide","graphics_slide_img","graphics hidden")\n
    }\n
    else{\n
      resetOneNavigation("next_slide","next_slide_img","next",text_file_name_list[slide_current_page_number+1])\n
      resetOneNavigation("last_slide","last_slide_img","last",text_file_name_list[slide_total_number-1])\n
      resetOneNavigation("graphics_slide","graphics_slide_img","graphics",img_file_name_list[slide_current_page_number])\n
      hideOneNavigation("text_slide","text_slide_img","text hidden")\n
    }\n
  }\n
  else if(slide_current_page_number+1==slide_total_number){\n
    if(current_page_is_img){\n
      resetOneNavigation("first_slide","first_slide_img","first",img_file_name_list[0])\n
      resetOneNavigation("previous_slide","previous_slide_img","previous",img_file_name_list[slide_current_page_number-1])\n
      resetOneNavigation("text_slide","text_slide_img","text",text_file_name_list[slide_current_page_number])\n
      hideOneNavigation("graphics_slide","graphics_slide_img","graphics hidden")\n
    }\n
    else{\n
      resetOneNavigation("first_slide","first_slide_img","first",text_file_name_list[0])\n
      resetOneNavigation("previous_slide","previous_slide_img","previous",text_file_name_list[slide_current_page_number-1])\n
      resetOneNavigation("graphics_slide","graphics_slide_img","graphics",img_file_name_list[slide_current_page_number])\n
      hideOneNavigation("text_slide","text_slide_img","text hidden")\n
    }\n
    hideOneNavigation("next_slide","next_slide_img","next shaded")\n
    hideOneNavigation("last_slide","last_slide_img","last shaded")\n
  }\n
  else{\n
    if(current_page_is_img){\n
      resetOneNavigation("first_slide","first_slide_img","first",img_file_name_list[0])\n
      resetOneNavigation("previous_slide","previous_slide_img","previous",img_file_name_list[slide_current_page_number-1])\n
      resetOneNavigation("next_slide","next_slide_img","next",img_file_name_list[slide_current_page_number+1])\n
      resetOneNavigation("last_slide","last_slide_img","last",img_file_name_list[slide_total_number-1])\n
      resetOneNavigation("text_slide","text_slide_img","text",text_file_name_list[slide_current_page_number])\n
      hideOneNavigation("graphics_slide","graphics_slide_img","graphics hidden")\n
    }\n
    else{\n
      resetOneNavigation("first_slide","first_slide_img","first",text_file_name_list[0])\n
      resetOneNavigation("previous_slide","previous_slide_img","previous",text_file_name_list[slide_current_page_number-1])\n
      resetOneNavigation("next_slide","next_slide_img","next",text_file_name_list[slide_current_page_number+1])\n
      resetOneNavigation("last_slide","last_slide_img","last",text_file_name_list[slide_total_number-1])\n
      resetOneNavigation("graphics_slide","graphics_slide_img","graphics",img_file_name_list[slide_current_page_number])\n
      hideOneNavigation("text_slide","text_slide_img","text hidden")\n
    }\n
  }\n
}\n
\n
function checkTheSelectionFieldAndGoToNewSlide(next_page_number,file_list){\n
//if entered number bigger than total number, go to last page, else incorrect number go to first page\n
  if( next_page_number>1 && next_page_number<slide_total_number){\n
    real_page_number=next_page_number-1;\n
    goToNewSlide(file_list[real_page_number]);\n
  }\n
  else if(next_page_number>=slide_total_number){\n
    real_page_number=slide_total_number-1\n
    goToNewSlide(file_list[real_page_number]);\n
  }\n
  else{\n
    goToNewSlide(file_list[0]);\n
  }\n
}\n
\n
function redirectPresentationPage(){\n
  next_page_number = $("#slide_selection_index").val()\n
  //Graphic pages\n
  if(current_page_is_img){\n
    checkTheSelectionFieldAndGoToNewSlide(next_page_number,img_file_name_list)\n
  }\n
  //Text pages\n
  else{\n
    checkTheSelectionFieldAndGoToNewSlide(next_page_number,text_file_name_list)\n
  }\n
}\n
\n
function preventEnterKeyInGlobal(){\n
  $(function(){\n
    var keyStop = {\n
      13: "input:text", // stop enter = submit \n
      end: null\n
    };\n
    $(document).bind("keydown", function(event){\n
     var selector = keyStop[event.which];\n
     if(selector !== undefined && $(event.target).is(selector)) {\n
       event.preventDefault(); //stop event\n
     }\n
     return true;\n
    });\n
  });\n
}\n
\n
$(document).ready(function() {\n
  file_name_list=getFileNameList();\n
  img_file_name_list=getImgFileNameList(file_name_list);\n
  text_file_name_list=getTextFileNameList(file_name_list);\n
  slide_total_number=file_name_list.length/2;\n
  $("#slides_total_number").text(slide_total_number);\n
  $("#slide_selection_index").keyup(function(event) {\n
    if (event.keyCode==13) {\n
      redirectPresentationPage()\n
    }\n
  });\n
  goToNewSlide(img_file_name_list[0]);\n
  preventEnterKeyInGlobal();\n
});\n
\n
""" % dict(\n
  absolute_url = dumps(absolute_url)\n
)\n


]]></string> </value>
        </item>
        <item>
            <key> <string>_params</string> </key>
            <value> <string></string> </value>
        </item>
        <item>
            <key> <string>id</string> </key>
            <value> <string>Presentation_renderSlidePage</string> </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
