<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <tuple>
        <tuple>
          <string>Products.PythonScripts.PythonScript</string>
          <string>PythonScript</string>
        </tuple>
        <none/>
      </tuple>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>Python_magic</string> </key>
            <value> <string encoding="base64">O/INCg==</string> </value>
        </item>
        <item>
            <key> <string>Script_magic</string> </key>
            <value> <int>3</int> </value>
        </item>
        <item>
            <key> <string>__ac_local_roles__</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_bind_names</string> </key>
            <value>
              <object>
                <klass>
                  <global name="NameAssignments" module="Shared.DC.Scripts.Bindings"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>_asgns</string> </key>
                        <value>
                          <dictionary>
                            <item>
                                <key> <string>name_container</string> </key>
                                <value> <string>container</string> </value>
                            </item>
                            <item>
                                <key> <string>name_context</string> </key>
                                <value> <string>context</string> </value>
                            </item>
                            <item>
                                <key> <string>name_m_self</string> </key>
                                <value> <string>script</string> </value>
                            </item>
                            <item>
                                <key> <string>name_subpath</string> </key>
                                <value> <string>traverse_subpath</string> </value>
                            </item>
                          </dictionary>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>_body</string> </key>
            <value> <string>LOG=lambda message: context.log("Account_getAccountingTransactionList", message)\n
\n
from Products.ERP5Type.Document import newTempAccountingTransaction\n
\n
kwd={"omit_simulation" : 1}\n
# read settings from user preference\n
preference = context.getPortalObject().portal_preferences\n
from_date = kw.get(\'from_date\', preference.getPreferredAccountingTransactionFromDate())\n
if from_date :\n
  kwd[\'from_date\'] = from_date\n
at_date = kw.get(\'at_date\', preference.getPreferredAccountingTransactionAtDate())\n
if at_date :\n
  kwd[\'at_date\'] = at_date\n
simulation_state = kw.get(\'simulation_state\', preference.getPreferredAccountingTransactionSimulationStateList())\n
if simulation_state :\n
  kwd[\'transaction_simulation_state\'] = simulation_state\n
section_category = preference.getPreferredAccountingTransactionSectionCategory()\n
if section_category :\n
  kwd[\'transaction_section_category\'] = section_category\n
\n
MARKER = []\n
source_payment_uid = kw.get(\'source_payment_uid\', MARKER)\n
if source_payment_uid is not MARKER:\n
  kwd[\'source_payment_uid\'] = source_payment_uid\n
no_source_payment = kw.get(\'no_source_payment_uid\', MARKER)\n
if no_source_payment is not MARKER:\n
  kwd[\'no_source_payment_uid\'] = 1\n
\n
destination_section_uid = kw.get(\'destination_section_uid\', MARKER)\n
if destination_section_uid is not MARKER:\n
  kwd[\'destination_section_uid\'] = destination_section_uid\n
no_destination_section_uid = kw.get(\'no_destination_section_uid\', MARKER)\n
if no_destination_section_uid is not MARKER:\n
  kwd[\'no_destination_section_uid\'] = 1\n
  \n
node_uid = kw.get(\'node_uid\', MARKER)\n
if node_uid is not MARKER:\n
  kwd[\'node_uid\'] = node_uid\n
  kwd[\'getUid\'] = node_uid # Account_zGetAccountingTransactionList compat\n
\n
# TODO: optimize this part\n
# ie evaluate only the displayed lines\n
\n
new_result = []\n
#LOG(\'kwd %s\' % kwd)\n
#LOG(\'SQL:\\n%s\'%context.Account_zGetAccountingTransactionList(src__=1, **kwd))\n
result = context.Account_zGetAccountingTransactionList(src__=src__, **kwd)\n
\n
net_balance = 0.0\n
\n
if from_date not in (None, MARKER) and kw.get(\'from_date_summary\', 0) :\n
  get_inventory_kw = {}\n
  get_inventory_kw[\'omit_simulation\'] = 1\n
  get_inventory_kw[\'section_category\'] = section_category # FIXME: shouldn\'t we use section_uid, ie displaying only the organisation rather than the group ???\n
  get_inventory_kw[\'node_uid\'] = kw.get(\'node_uid\', context.getUid())\n
  if simulation_state :\n
    get_inventory_kw[\'simulation_state\'] = simulation_state\n
  if destination_section_uid is not MARKER :\n
    get_inventory_kw[\'mirror_section_uid\'] = destination_section_uid\n
  if source_payment_uid is not MARKER :\n
    get_inventory_kw[\'payment_uid\'] = source_payment_uid\n
\n
  getInventory = context.getPortalObject().portal_simulation.getInventory\n
  last_total_source_debit = getInventory(omit_output=1, to_date=from_date, **get_inventory_kw)\n
  last_total_source_credit = getInventory(omit_input=1, to_date=from_date, **get_inventory_kw)\n
  if last_total_source_credit != 0 : \n
    last_total_source_credit = - last_total_source_credit \n
\n
  if last_total_source_debit != 0 or last_total_source_credit  != 0 :\n
    from_date_summary = newTempAccountingTransaction(\n
          context.getPortalObject(), "temp_%s" % context.getUid())\n
    from_date_summary.setUid(\'new_000\')\n
    net_balance = last_total_source_debit - last_total_source_credit\n
    from_date_summary.edit(\n
          title = context.Base_TranslateString("Previous Balance"),\n
          translated_portal_type = "",\n
          translated_simulation_state_title = "",\n
          net_balance = net_balance, \n
          source_balance = net_balance,\n
          source_credit = last_total_source_credit,\n
          source_debit = last_total_source_debit,\n
          current_transaction_line_path = None,\n
          third_party = None,\n
    )\n
    new_result.append(from_date_summary)\n
\n
if src__:\n
  return result\n
\n
for l in result:\n
  o = l.getObject()\n
  net_balance += l.source_balance or 0.0\n
  if o is not None:\n
    c = o.asContext( net_balance = net_balance,\n
                       source_balance = l.source_balance,\n
                       source_credit = l.source_credit,\n
                       source_debit = l.source_debit,\n
                       current_transaction_line_path = l.current_transaction_line_path,\n
                       third_party = l.third_party,\n
                       source_payment = l.source_payment_uid\n
                  )\n
    new_result.append(c)\n
\n
return new_result\n
</string> </value>
        </item>
        <item>
            <key> <string>_code</string> </key>
            <value> <string encoding="base64">YwAAAAAAAAAAAgAAAEAAAABzEAAAAGQBAGQCAIQBAFoAAGQAAFMoAwAAAE5pAAAAAGMBAAAAIgAA
AEkAAABLAAAAc5gFAABkAQCEAAB9AgBkAgBrAQBsAgB9BAABaAAABGQDAGQEAAM8fQUAdAQAdAQA
dAUAZAUAgwIAgwAAZAYAgwIAfQgAdAQAfAEAZAcAgwIAZAgAdAQAfAgAZAkAgwIAgwAAgwIAfQkA
fAkAbxQAAXwJAHQJAHwFAIMBAGQIADxuAQABdAQAfAEAZAcAgwIAZAoAdAQAfAgAZAsAgwIAgwAA
gwIAfQsAfAsAbxQAAXwLAHQJAHwFAIMBAGQKADxuAQABdAQAfAEAZAcAgwIAZAwAdAQAfAgAZA0A
gwIAgwAAgwIAfQwAfAwAbxQAAXwMAHQJAHwFAIMBAGQOADxuAQABdAQAfAgAZA8AgwIAgwAAfQ0A
fA0AbxQAAXwNAHQJAHwFAIMBAGQQADxuAQABZwAAfQ4AdAQAfAEAZAcAgwIAZBEAfA4AgwIAfQ8A
fA8AfA4AagkAbxQAAXwPAHQJAHwFAIMBAGQRADxuAQABdAQAfAEAZAcAgwIAZBIAfA4AgwIAfRAA
fBAAfA4AagkAbxQAAWQEAHQJAHwFAIMBAGQSADxuAQABdAQAfAEAZAcAgwIAZBMAfA4AgwIAfREA
fBEAfA4AagkAbxQAAXwRAHQJAHwFAIMBAGQTADxuAQABdAQAfAEAZAcAgwIAZBQAfA4AgwIAfRIA
fBIAfA4AagkAbxQAAWQEAHQJAHwFAIMBAGQUADxuAQABdAQAfAEAZAcAgwIAZBUAfA4AgwIAfRMA
fBMAfA4AagkAbyQAAXwTAHQJAHwFAIMBAGQVADx8EwB0CQB8BQCDAQBkFgA8bgEAAWcAAH0UAHQU
AHQEAHQFAGQXAIMCAGQYAHwAAHwFAI0BAX0WAGQZAH0XAHwJAHQYAHwOAGYCAGoHAG8WAAF0BAB8
AQBkBwCDAgBkGgBkGwCDAgBv9QEBaAAAfRkAZAQAdAkAfBkAgwEAZAMAPHwNAHQJAHwZAIMBAGQc
ADx0BAB8AQBkBwCDAgBkFQB0BAB0BQBkFgCDAgCDAACDAgB0CQB8GQCDAQBkFQA8fAwAbxQAAXwM
AHQJAHwZAIMBAGQMADxuAQABfBEAfA4AagkAbxQAAXwRAHQJAHwZAIMBAGQdADxuAQABfA8AfA4A
agkAbxQAAXwPAHQJAHwZAIMBAGQeADxuAQABdAQAdAQAdAQAdAUAZAUAgwIAgwAAZB8AgwIAZCAA
gwIAfRoAdBQAfBoAZCEAZAQAZCIAfAkAfBkAjQECfRsAdBQAfBoAZCMAZAQAZCIAfAkAfBkAjQEC
fRwAfBwAZBsAagMAbwsAAXwcAAt9HABuAQABfBsAZBsAagMAcAoAAXwcAGQbAGoDAG+0AAF8BAB0
BAB0BQBkBQCDAgCDAABkJAB0BAB0BQBkFgCDAgCDAAAWgwIAfR0AdAQAfB0AZCUAgwIAZCYAgwEA
AXwbAHwcABh9FwB0BAB8HQBkJwCDAgBkKAB0BAB0BQBkKQCDAgBkKgCDAQBkKwBkLABkLQBkLABk
LgB8FwBkLwB8FwBkMAB8HABkMQB8GwBkMgB0GABkMwB0GACDAAkBdAQAfBQAZDQAgwIAfB0AgwEA
AXGoBAFuAQABfAAAbwgAAXwWAFNuAQABeNYAdB4AfBYAgwEARF3IAH0fAHQEAHwfAGQ1AIMCAIMA
AH0gAHwXAHQEAHwfAGQvAIMCAHAEAAFkGQA3fRcAfCAAdBgAagkAb4kAAXQEAHwgAGQ2AIMCAGQu
AHwXAGQvAHQEAHwfAGQvAIMCAGQwAHQEAHwfAGQwAIMCAGQxAHQEAHwfAGQxAIMCAGQyAHQEAHwf
AGQyAIMCAGQzAHQEAHwfAGQzAIMCAGQ3AHQEAHwfAGQRAIMCAIMAB30hAHQEAHwUAGQ0AIMCAHwh
AIMBAAFxxAQBccQEV3wUAFNkAABTKDgAAABOYwEAAAADAAAAAwAAAEMAAABzFgAAAHQAAHQBAGQB
AIMCAGQCAHwAAIMCAFMoAwAAAE5zAwAAAGxvZ3MkAAAAQWNjb3VudF9nZXRBY2NvdW50aW5nVHJh
bnNhY3Rpb25MaXN0KAMAAABzCQAAAF9nZXRhdHRyX3MHAAAAY29udGV4dHMHAAAAbWVzc2FnZSgD
AAAAcwcAAABtZXNzYWdlcwkAAABfZ2V0YXR0cl9zBwAAAGNvbnRleHQoAAAAACgAAAAAcw8AAABT
Y3JpcHQgKFB5dGhvbilzCwAAADxsYW1iZGEuMzI+AQAAAHMAAAAAKAEAAABzHAAAAG5ld1RlbXBB
Y2NvdW50aW5nVHJhbnNhY3Rpb25zDwAAAG9taXRfc2ltdWxhdGlvbmkBAAAAcw8AAABnZXRQb3J0
YWxPYmplY3RzEgAAAHBvcnRhbF9wcmVmZXJlbmNlc3MDAAAAZ2V0cwkAAABmcm9tX2RhdGVzKQAA
AGdldFByZWZlcnJlZEFjY291bnRpbmdUcmFuc2FjdGlvbkZyb21EYXRlcwcAAABhdF9kYXRlcycA
AABnZXRQcmVmZXJyZWRBY2NvdW50aW5nVHJhbnNhY3Rpb25BdERhdGVzEAAAAHNpbXVsYXRpb25f
c3RhdGVzNAAAAGdldFByZWZlcnJlZEFjY291bnRpbmdUcmFuc2FjdGlvblNpbXVsYXRpb25TdGF0
ZUxpc3RzHAAAAHRyYW5zYWN0aW9uX3NpbXVsYXRpb25fc3RhdGVzMAAAAGdldFByZWZlcnJlZEFj
Y291bnRpbmdUcmFuc2FjdGlvblNlY3Rpb25DYXRlZ29yeXMcAAAAdHJhbnNhY3Rpb25fc2VjdGlv
bl9jYXRlZ29yeXMSAAAAc291cmNlX3BheW1lbnRfdWlkcxUAAABub19zb3VyY2VfcGF5bWVudF91
aWRzFwAAAGRlc3RpbmF0aW9uX3NlY3Rpb25fdWlkcxoAAABub19kZXN0aW5hdGlvbl9zZWN0aW9u
X3VpZHMIAAAAbm9kZV91aWRzBgAAAGdldFVpZHMlAAAAQWNjb3VudF96R2V0QWNjb3VudGluZ1Ry
YW5zYWN0aW9uTGlzdHMFAAAAc3JjX19mAzAuMHMRAAAAZnJvbV9kYXRlX3N1bW1hcnlpAAAAAHMQ
AAAAc2VjdGlvbl9jYXRlZ29yeXMSAAAAbWlycm9yX3NlY3Rpb25fdWlkcwsAAABwYXltZW50X3Vp
ZHMRAAAAcG9ydGFsX3NpbXVsYXRpb25zDAAAAGdldEludmVudG9yeXMLAAAAb21pdF9vdXRwdXRz
BwAAAHRvX2RhdGVzCgAAAG9taXRfaW5wdXRzBwAAAHRlbXBfJXNzBgAAAHNldFVpZHMHAAAAbmV3
XzAwMHMEAAAAZWRpdHMFAAAAdGl0bGVzFAAAAEJhc2VfVHJhbnNsYXRlU3RyaW5ncxAAAABQcmV2
aW91cyBCYWxhbmNlcxYAAAB0cmFuc2xhdGVkX3BvcnRhbF90eXBlcwAAAABzIQAAAHRyYW5zbGF0
ZWRfc2ltdWxhdGlvbl9zdGF0ZV90aXRsZXMLAAAAbmV0X2JhbGFuY2VzDgAAAHNvdXJjZV9iYWxh
bmNlcw0AAABzb3VyY2VfY3JlZGl0cwwAAABzb3VyY2VfZGViaXRzHQAAAGN1cnJlbnRfdHJhbnNh
Y3Rpb25fbGluZV9wYXRocwsAAAB0aGlyZF9wYXJ0eXMGAAAAYXBwZW5kcwkAAABnZXRPYmplY3Rz
CQAAAGFzQ29udGV4dHMOAAAAc291cmNlX3BheW1lbnQoIgAAAHMDAAAATE9HcxoAAABQcm9kdWN0
cy5FUlA1VHlwZS5Eb2N1bWVudHMcAAAAbmV3VGVtcEFjY291bnRpbmdUcmFuc2FjdGlvbnMDAAAA
a3dkcwkAAABfZ2V0YXR0cl9zBwAAAGNvbnRleHRzCgAAAHByZWZlcmVuY2VzAgAAAGt3cwkAAABm
cm9tX2RhdGVzBwAAAF93cml0ZV9zBwAAAGF0X2RhdGVzEAAAAHNpbXVsYXRpb25fc3RhdGVzEAAA
AHNlY3Rpb25fY2F0ZWdvcnlzBgAAAE1BUktFUnMSAAAAc291cmNlX3BheW1lbnRfdWlkcxEAAABu
b19zb3VyY2VfcGF5bWVudHMXAAAAZGVzdGluYXRpb25fc2VjdGlvbl91aWRzGgAAAG5vX2Rlc3Rp
bmF0aW9uX3NlY3Rpb25fdWlkcwgAAABub2RlX3VpZHMKAAAAbmV3X3Jlc3VsdHMHAAAAX2FwcGx5
X3MFAAAAc3JjX19zBgAAAHJlc3VsdHMLAAAAbmV0X2JhbGFuY2VzBAAAAE5vbmVzEAAAAGdldF9p
bnZlbnRvcnlfa3dzDAAAAGdldEludmVudG9yeXMXAAAAbGFzdF90b3RhbF9zb3VyY2VfZGViaXRz
GAAAAGxhc3RfdG90YWxfc291cmNlX2NyZWRpdHMRAAAAZnJvbV9kYXRlX3N1bW1hcnlzCQAAAF9n
ZXRpdGVyX3MBAAAAbHMBAAAAb3MBAAAAYygiAAAAcwUAAABzcmNfX3MCAAAAa3dzAwAAAExPR3Ma
AAAAUHJvZHVjdHMuRVJQNVR5cGUuRG9jdW1lbnRzHAAAAG5ld1RlbXBBY2NvdW50aW5nVHJhbnNh
Y3Rpb25zAwAAAGt3ZHMJAAAAX2dldGF0dHJfcwcAAABjb250ZXh0cwoAAABwcmVmZXJlbmNlcwkA
AABmcm9tX2RhdGVzBwAAAF93cml0ZV9zBwAAAGF0X2RhdGVzEAAAAHNpbXVsYXRpb25fc3RhdGVz
EAAAAHNlY3Rpb25fY2F0ZWdvcnlzBgAAAE1BUktFUnMSAAAAc291cmNlX3BheW1lbnRfdWlkcxEA
AABub19zb3VyY2VfcGF5bWVudHMXAAAAZGVzdGluYXRpb25fc2VjdGlvbl91aWRzGgAAAG5vX2Rl
c3RpbmF0aW9uX3NlY3Rpb25fdWlkcwgAAABub2RlX3VpZHMKAAAAbmV3X3Jlc3VsdHMHAAAAX2Fw
cGx5X3MGAAAAcmVzdWx0cwsAAABuZXRfYmFsYW5jZXMEAAAATm9uZXMQAAAAZ2V0X2ludmVudG9y
eV9rd3MMAAAAZ2V0SW52ZW50b3J5cxcAAABsYXN0X3RvdGFsX3NvdXJjZV9kZWJpdHMYAAAAbGFz
dF90b3RhbF9zb3VyY2VfY3JlZGl0cxEAAABmcm9tX2RhdGVfc3VtbWFyeXMJAAAAX2dldGl0ZXJf
cwEAAABscwEAAABvcwEAAABjKAAAAAAoAAAAAHMPAAAAU2NyaXB0IChQeXRob24pcyQAAABBY2Nv
dW50X2dldEFjY291bnRpbmdUcmFuc2FjdGlvbkxpc3QBAAAAc6IAAAAJAg0CDwIbASQBBwEUASQB
BwEUASQBBwEUARIBBwEUAgYBGAENARQBGAENARQCGAENARQBGAENARQCGAENARABFAUGAx4CBgIs
AQYBEAEQAS4BBwEUAQ0BFAENARQCJAEbARsBDQELAhoBBgEoARABDQEPAR4DBgEGAQYBBgEGAQoC
GAIHAQgCDQAGARIBGgENARgBDwEPAQ8BDwEPARICGAIoAQAAAHMkAAAAQWNjb3VudF9nZXRBY2Nv
dW50aW5nVHJhbnNhY3Rpb25MaXN0KAEAAABzJAAAAEFjY291bnRfZ2V0QWNjb3VudGluZ1RyYW5z
YWN0aW9uTGlzdCgAAAAAKAAAAABzDwAAAFNjcmlwdCAoUHl0aG9uKXMIAAAAPG1vZHVsZT4BAAAA
cwAAAAA=</string> </value>
        </item>
        <item>
            <key> <string>_dav_writelocks</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAI=</string> </persistent>
            </value>
        </item>
        <item>
            <key> <string>_filepath</string> </key>
            <value> <string>Script (Python):/nexedi/portal_skins/erp5_accounting/Account_getAccountingTransactionList</string> </value>
        </item>
        <item>
            <key> <string>_params</string> </key>
            <value> <string>src__=0, **kw</string> </value>
        </item>
        <item>
            <key> <string>errors</string> </key>
            <value>
              <tuple/>
            </value>
        </item>
        <item>
            <key> <string>func_code</string> </key>
            <value>
              <object>
                <klass>
                  <global name="FuncCode" module="Shared.DC.Scripts.Signature"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>co_argcount</string> </key>
                        <value> <int>1</int> </value>
                    </item>
                    <item>
                        <key> <string>co_varnames</string> </key>
                        <value>
                          <tuple>
                            <string>src__</string>
                            <string>kw</string>
                            <string>LOG</string>
                            <string>Products.ERP5Type.Document</string>
                            <string>newTempAccountingTransaction</string>
                            <string>kwd</string>
                            <string>_getattr_</string>
                            <string>context</string>
                            <string>preference</string>
                            <string>from_date</string>
                            <string>_write_</string>
                            <string>at_date</string>
                            <string>simulation_state</string>
                            <string>section_category</string>
                            <string>MARKER</string>
                            <string>source_payment_uid</string>
                            <string>no_source_payment</string>
                            <string>destination_section_uid</string>
                            <string>no_destination_section_uid</string>
                            <string>node_uid</string>
                            <string>new_result</string>
                            <string>_apply_</string>
                            <string>result</string>
                            <string>net_balance</string>
                            <string>None</string>
                            <string>get_inventory_kw</string>
                            <string>getInventory</string>
                            <string>last_total_source_debit</string>
                            <string>last_total_source_credit</string>
                            <string>from_date_summary</string>
                            <string>_getiter_</string>
                            <string>l</string>
                            <string>o</string>
                            <string>c</string>
                          </tuple>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>func_defaults</string> </key>
            <value>
              <tuple>
                <int>0</int>
              </tuple>
            </value>
        </item>
        <item>
            <key> <string>id</string> </key>
            <value> <string>Account_getAccountingTransactionList</string> </value>
        </item>
        <item>
            <key> <string>warnings</string> </key>
            <value>
              <tuple/>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="2" aka="AAAAAAAAAAI=">
    <pickle>
      <tuple>
        <tuple>
          <string>Persistence</string>
          <string>PersistentMapping</string>
        </tuple>
        <none/>
      </tuple>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>_container</string> </key>
            <value>
              <dictionary/>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
