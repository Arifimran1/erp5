<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <tuple>
        <tuple>
          <string>Products.PythonScripts.PythonScript</string>
          <string>PythonScript</string>
        </tuple>
        <none/>
      </tuple>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>Python_magic</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>Script_magic</string> </key>
            <value> <int>3</int> </value>
        </item>
        <item>
            <key> <string>__ac_local_roles__</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_bind_names</string> </key>
            <value>
              <object>
                <klass>
                  <global name="NameAssignments" module="Shared.DC.Scripts.Bindings"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>_asgns</string> </key>
                        <value>
                          <dictionary>
                            <item>
                                <key> <string>name_container</string> </key>
                                <value> <string>container</string> </value>
                            </item>
                            <item>
                                <key> <string>name_context</string> </key>
                                <value> <string>context</string> </value>
                            </item>
                            <item>
                                <key> <string>name_m_self</string> </key>
                                <value> <string>script</string> </value>
                            </item>
                            <item>
                                <key> <string>name_subpath</string> </key>
                                <value> <string>traverse_subpath</string> </value>
                            </item>
                          </dictionary>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>_body</string> </key>
            <value> <string encoding="cdata"><![CDATA[

"""\n
  Script called by user registration form; checks if all required parameters\n
  are supplied, handles errors, calls WebSite_createUser to actually\n
  create Person.\n
  Will send email with password info.\n
\n
  XXX - redirect, translation of dialogs\n
"""\n
\n
req = context.REQUEST\n
\n
# check if everything was filled\n
fields = (\'email\', \'email_repeated\', \'group\', \'function\', \'site\', \'first_name\', \'last_name\')\n
missing_string = \'\'\n
kwargs = {}\n
for f in fields:\n
  value = req.get(\'your_\' + f)\n
  if not value:\n
    missing_string += \'&missing:list=\' + f\n
  else:\n
    kwargs[f] = value\n
returned_params = \'&\'.join([f+\'=\'+kwargs[f] for f in kwargs])\n
context.log(returned_params)\n
if missing_string:\n
  params = returned_params + \'&\' + missing_string + \'&portal_status_message=You did not fill all the required fields. See below to find out which fields still have to be filled.\'\n
  context.log(params)\n
  return req.RESPONSE.redirect(context.absolute_url()+\'?\'+params)\n
if req.get(\'your_email\') != req.get(\'your_email_repeated\'):\n
  missing_string += \'&missing:list=email&missing:list=email_repeated\'\n
  params = returned_params + \'&\' + missing_string + \'&portal_status_message=You entered two different email addresses. Please make sure to enter the same email adress in the fields Email Adress and Repeat Email Adress.\'\n
  return req.RESPONSE.redirect(context.absolute_url()+\'?\'+params)\n
\n
# create a user\n
context.log(kwargs)\n
try:\n
  user = context.WebSite_createUser(**kwargs)\n
  context.log(user)\n
  msg = \'Thank you for registering. Your password will be sent to the email adress that you provided once your account has been validated by the appropriate department.\'\n
except Exception, e:\n
  msg = str(e)\n
\n
return req.RESPONSE.redirect(context.absolute_url()+\'?portal_status_message=\'+msg)\n


]]></string> </value>
        </item>
        <item>
            <key> <string>_code</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_filepath</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>_params</string> </key>
            <value> <string>*a, **kw</string> </value>
        </item>
        <item>
            <key> <string>errors</string> </key>
            <value>
              <tuple/>
            </value>
        </item>
        <item>
            <key> <string>func_code</string> </key>
            <value>
              <object>
                <klass>
                  <global name="FuncCode" module="Shared.DC.Scripts.Signature"/>
                </klass>
                <tuple/>
                <state>
                  <dictionary>
                    <item>
                        <key> <string>co_argcount</string> </key>
                        <value> <int>0</int> </value>
                    </item>
                    <item>
                        <key> <string>co_varnames</string> </key>
                        <value>
                          <tuple>
                            <string>a</string>
                            <string>kw</string>
                            <string>_getattr_</string>
                            <string>context</string>
                            <string>req</string>
                            <string>fields</string>
                            <string>missing_string</string>
                            <string>kwargs</string>
                            <string>_getiter_</string>
                            <string>f</string>
                            <string>value</string>
                            <string>_write_</string>
                            <string>append</string>
                            <string>$append0</string>
                            <string>_getitem_</string>
                            <string>returned_params</string>
                            <string>params</string>
                            <string>_apply_</string>
                            <string>user</string>
                            <string>msg</string>
                            <string>Exception</string>
                            <string>e</string>
                            <string>str</string>
                          </tuple>
                        </value>
                    </item>
                  </dictionary>
                </state>
              </object>
            </value>
        </item>
        <item>
            <key> <string>func_defaults</string> </key>
            <value>
              <none/>
            </value>
        </item>
        <item>
            <key> <string>id</string> </key>
            <value> <string>WebSite_registerUser</string> </value>
        </item>
        <item>
            <key> <string>warnings</string> </key>
            <value>
              <tuple/>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
