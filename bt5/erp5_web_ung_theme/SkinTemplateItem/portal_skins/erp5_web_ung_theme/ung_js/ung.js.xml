<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <global name="DTMLMethod" module="OFS.DTMLMethod"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>_Cacheable__manager_id</string> </key>
            <value> <string>http_cache</string> </value>
        </item>
        <item>
            <key> <string>__name__</string> </key>
            <value> <string>ung.js</string> </value>
        </item>
        <item>
            <key> <string>_vars</string> </key>
            <value>
              <dictionary/>
            </value>
        </item>
        <item>
            <key> <string>globals</string> </key>
            <value>
              <dictionary/>
            </value>
        </item>
        <item>
            <key> <string>raw</string> </key>
            <value> <string encoding="cdata"><![CDATA[

function getCurrentObjectUrl(){\n
  return window.location.href.split("?")[0];\n
}\n
\n
function getWebEditorName(){\n
  currentUrlSplitted = window.location.href.split("?")[0].split("/");\n
  return currentUrlSplitted[currentUrlSplitted.length-1];\n
}\n
\n
function createBlankSpace(amount){\n
  blankSpaceStr = "";\n
  for (var n=1; n < amount; n++)\n
    blankSpaceStr += "&nbsp;";\n
  return blankSpaceStr;     \n
}\n
\n
function getUrlParameterList(){\n
  var argumentList = {};\n
  resultList = window.location.href.split("?")[1].split("&");\n
  for (var i=0;i<resultList.length;i++){\n
    parameterList = (resultList[i].replace(":int","")).split("=");\n
    argumentList[parameterList[0]] = parameterList[1];\n
  }\n
  return argumentList;\n
}\n
\n
function getObjectPropertyValue(method_name){\n
  return $.ajax({\n
            url: method_name,\n
            async: false,\n
         }).responseText;\n
}\n
\n
function showNotImplementedMessage(tag){\n
  $(tag).fadeIn(400).delay(1000).slideUp(1000);\n
}\n
\n
function updateWebPage(){\n
  var parameterList = getUrlParameterList();\n
  url = "Base_updateWebDocument?document_path=" + parameterList.document_path + "&webpage_path=" + parameterList.webpage_path;\n
  $.get(url, {}, function(data, textStatus, XMLHttpRequest){\n
    response = jQuery.parseJSON(data);\n
    if (response.status != 200){\n
      setTimeout(updateWebPage(), 1500);\n
    }\n
    else {\n
      clearTimeout();\n
      window.location = getCurrentObjectUrl() + "?editable_mode:int=1";\n
    }\n
  });\n
}\n
\n
function checkConversion(){\n
  $.get("Base_getDocumentConversionState?path=" + parameterList.document_path, {},\n
                                               function(data, textStatus, XMLHttpRequest){\n
     status = jQuery.parseJSON(data);\n
     if (status != "converted"){\n
       setTimeout(checkConversion(), 1500);\n
     }\n
     else {\n
       clearTimeout();\n
       setTimeout(updateWebPage(), 1000);\n
     }\n
});\n
}\n
\n
function setObjectPropertyValue(method_name, value, parameter){\n
  $.ajax({\n
        type: "POST",\n
        url: method_name,\n
        data: parameter + "=" + value,\n
  });\n
  return true;\n
}\n
\n
function changeCheckBoxValue(value){\n
  $("table.listbox tbody tr td.listbox-table-select-cell input").each(function(){\n
    this.checked = value;\n
  });\n
}\n
\n
$(document).ready(function(){\n
  if ($("div.gadget-column").length == 0 && window.location.href.split("?").length > 1) {\n
    parameterList = getUrlParameterList();\n
    if (parameterList.hasOwnProperty("upload_document") == true){\n
      $("a[name=\'document_title\'], a[name=\'document_state\'], div.header-right, div.content").hide();\n
      $("a#loading_message").show();\n
      setTimeout(checkConversion(), 1000);\n
    }\n
    switch (getWebEditorName()) {\n
      case "WebPage_viewEditor":\n
        $("div.content").css({"position":"fixed", "bottom": "0px",\n
                              "left": "0px", "right": "0px"});\n
        $("div.content").css({"top": "5em"});\n
        break;\n
      case "WebTable_viewEditor":\n
        $("div.content").css({"position":"fixed", "bottom": "0px",\n
                              "left": "0px", "right": "0px"});\n
        $("div.content").css({"top": "6em"});\n
        $.getJSON("Base_getPreferencePathList", function(data){\n
          var ungPreferencePath = data.preference;\n
          $.get(ungPreferencePath + \'/getPreferredThemeSheetEditor\', function(data){\n
            link = $("<link>");\n
            link.attr("id", "dynamic_css");\n
            link.attr({type: \'text/css\', rel:\'stylesheet\', href:data});\n
            $("head").append(link);\n
          });\n
        });     \n
        break;\n
    }\n
  }\n
  $("a[name=\'document_title\']").html(getObjectPropertyValue("getTitle"));\n
  $("input#upload").click(function(event){\n
   event.preventDefault();\n
   $("#upload_document").dialog("open");\n
  });\n
  $("tbody tr td.listbox-table-domain-tree-cell a").each(function(){\n
     if ($(this).text().length == 16){\n
       $(this).css("padding-right", "82px")\n
     }\n
     if ($(this).text().length > 16){\n
       $(this).css("padding-right", "35px")\n
     }\n
  });\n
  if ($("div.gadget-column").length == 1) {\n
   $("a.domain_selected").text($("a.tree-open").text());\n
   $("a.tree-open, a.tree-closed").each(function(){\n
     if ($(this).text() == "Starred" || $(this).text() == "Hidden")\n
       $(this).html($(this).text() + createBlankSpace(11));\n
     if ($(this).text() == "Trash")\n
       $(this).html($(this).text() + createBlankSpace(13));\n
   })\n
   var listboxTreeHeight = $("div.listbox-tree").css("height").replace("px", "");\n
   var domainTreeHeight = $("div.listbox-domain-tree-container").css("height").replace("px", "");\n
   if (parseInt(listboxTreeHeight) > parseInt(domainTreeHeight)){\n
     window.onload = function() {\n
       $("div.listbox-tree").css("height", $("div.listbox-domain-tree-container").css("height"));\n
     }\n
   }\n
   if (parseInt(domainTreeHeight) > 233) {\n
     window.onload = function() {\n
       $("div.listbox-tree").css("overflow-y", "scroll");\n
     }\n
   }\n
   $("body").css("overflow", "hidden");\n
   var navigation_html = $("div.listbox-footer div.listbox-page-navigation").html();\n
   $("div.listbox-footer div.listbox-page-navigation").remove();\n
   var navigation_div = "<div class=\'listbox-navigation\'>" + navigation_html + "</div>";\n
   $("div.toolbar").append(navigation_div);\n
   var listbox_tree_html = $("div.listbox-tree").html();\n
   var listbox_tree_div = "<div class=\'listbox-tree\'>" + listbox_tree_html + "</div>";\n
   $("div.listbox-tree").remove();\n
   $("div.file-quick-search").append(listbox_tree_div);\n
   var tr_length = $("div.main-right tbody tr").length;\n
   if (tr_length < 16){\n
     var height = tr_length * 1.5;\n
     $("div.main-right tbody").css("height", height + "em");\n
   }\n
   if ($("div.listbox-navigation").text() == "null")\n
     $("div.listbox-navigation").hide();\n
 }\n
 else {\n
  $("div.action_menu ul li a").click(function(event){\n
   event.preventDefault();\n
   herfList = this.getAttribute("href").split("?");\n
   action_name = herfList[herfList.length-1].split("=")[1];\n
   $.ajax({url: "Base_changeWorkflowState", \n
           data: "action_name=" + action_name,\n
           success: function(){\n
             window.location.reload();\n
          },\n
   });\n
  });\n
  if ($("a[name=\'document_state\']").text() == "Draft") {\n
    $("div.action_menu li ul").append("<li><a id=\'share_document\' href=\'#\'>" + \n
                                      "<h6>Share this Document</h6></a></li>");\n
    $("div.action_menu ul li a#share_document").click(function(event){\n
      event.preventDefault();\n
      $.ajax({\n
              url: \'WebSection_shareDocument\',\n
              async: false,\n
             });\n
      location.reload();\n
    });\n
  };\n
  $("div.action_menu li ul").css("height",\n
                   $("div.action_menu li ul li").length * 25.3 + "px");\n
  if ($("a[name=\'document_state\']").text() == "Shared"){\n
    reference = $.ajax({\n
                       url: \'getReference\',\n
                       async: false,\n
                     }).responseText;\n
    keyUrl = location.href.split("web_page_module")[0] + "?key=" + reference;\n
    $("div.header-right fieldset.widget a#sharing_url").text(keyUrl);\n
  };\n
 };\n
 $("#edit_document").dialog({\n
    autoOpen: false,\n
    height: 146,\n
    width: 389,\n
    modal: true,\n
    buttons: {\n
      "Save": function(){\n
         var new_title = $("input#name.title").attr("value");\n
         var new_reference = $("input#reference.reference").attr("value");\n
         var new_short_title = $("input#short_title.short_title").attr("value");\n
         var new_language = $("input#language.language").attr("value");\n
         var new_version = $("input#version.version").attr("value");\n
         var new_int_index = $("input#sort_index.sort_index").attr("value");\n
         $("a[name=\'document_title\']").html(new_title);\n
         setObjectPropertyValue("setTitle", new_title, "value");\n
         setObjectPropertyValue("setReference", new_reference, "value");\n
         setObjectPropertyValue("setShortTitle", new_short_title, "value");\n
         setObjectPropertyValue("setLanguage", new_language, "language");\n
         setObjectPropertyValue("setVersion", new_version, "value");\n
         setObjectPropertyValue("setIntIndex", new_int_index, "value");\n
         $("#edit_document").dialog("close");\n
         $("button.save").click();\n
       },\n
       Cancel: function() {\n
         $(this).dialog("close");\n
       },\n
    }\n
 });\n
 $("#upload_document").dialog({\n
    autoOpen: false,\n
    height: 116,\n
    width: 346,\n
    modal: true,\n
 });\n
 $("div.gadget-listbox").dialog({\n
    autoOpen: false,\n
    height: 416,\n
    width: 500,\n
    modal: true,\n
    buttons: {\n
      "Add": function(){\n
         window.location.reload();\n
       },\n
    }\n
 });\n
 $("div#preference_dialog").dialog({\n
    autoOpen: false,\n
    height: 487,\n
    width: 330,\n
    modal:true,\n
    buttons: {\n
      "Save": function(){\n
         var erp5PreferenceArgument = $("form#erp5_preference").serialize();\n
         $.ajax({\n
                url: ungPreferencePath + "/Base_edit",\n
                data: erp5PreferenceArgument + "&form_id=Preference_viewHtmlStyle",\n
         });\n
         var systemPreferenceArgument = $("form#system_preference").serialize();\n
         $.ajax({\n
                url: systemPreferencePath + "/Base_edit",\n
                data: systemPreferenceArgument + "&form_id=SystemPreference_view",\n
         });\n
         var ungPreferenceArgument = $("form#ung_preference").serialize();\n
         $.ajax({\n
                url: ungPreferencePath + "/Base_edit",\n
                data: ungPreferenceArgument + "&form_id=UNGPreference_view",\n
         });\n
        location.reload();\n
       },\n
       Cancel: function() {\n
         $(this).dialog("close");\n
       },\n
    }\n
 });\n
 $("p#more_properties")\n
    .click(function(){\n
      $("div#more_property").show();\n
      $("p#hide_properties").show();\n
      $("div#edit_document fieldset").animate({"height": "151px"}, "slow");\n
      $("div.ui-dialog").animate({"top": "50px"}, "slow")\n
                        .animate({"height": "228px"}, "slow");\n
      $("div#edit_document").animate({"height": "157px"}, "slow");\n
      $("div#edit_document fieldset input").css("margin", "0")\n
                                           .css("width", "60%");\n
      $("div#edit_document fieldset label").css("float", "left")\n
                                           .css("width", "35%");\n
      $("div#more_property input").css("width", "47%");\n
      $("p#more_properties").hide();\n
    });\n
 $("p#hide_properties")\n
    .click(function(){\n
      $("div#more_property").hide();\n
      $("p#more_properties").show();\n
      $("p#hide_properties").hide();\n
      $("div#edit_document fieldset input").css("width", "95%")\n
                                           .css("margin-top", "14px");\n
      $("div#edit_document fieldset").animate({"height": "69px"}, "slow");\n
      $("div.ui-dialog").animate({"height": "148px"}, "slow");\n
      $("div#edit_document").animate({"height": "78px"}, "slow");\n
    });\n
  $("a#settings")\n
    .click(function(event){\n
      event.preventDefault();\n
      $("div#preference_dialog").dialog("open");\n
    });\n
 $("button.ui-button, span.ui-icon").click(function(){$("p#hide_properties").click()});\n
 $("a[name=\'document_title\']")\n
    .click(function(){\n
        $("div#more_property").hide();\n
        $("p#hide_properties").hide();\n
        if ($("input#name.title").attr("value") != getObjectPropertyValue("getTitle")) {\n
            $(this).html(getObjectPropertyValue("getTitle"));\n
        }\n
        $("input#name.title").attr("value", getObjectPropertyValue("getTitle"));\n
        $("input#short_title.short_title").attr("value", getObjectPropertyValue("getShortTitle"));\n
        $("input#reference.reference").attr("value", getObjectPropertyValue("getReference"));\n
        $("input#version.version").attr("value", getObjectPropertyValue("getVersion"));\n
        $("input#language.language").attr("value", getObjectPropertyValue("getLanguage"));\n
        $("input#sort_index.sort_index").attr("value", getObjectPropertyValue("getIntIndex"));\n
        $("#edit_document").dialog("open");     \n
    });\n
 $("a#help").click(function(event){\n
   event.preventDefault();\n
   showNotImplementedMessage("a#right_message");\n
 });\n
 $("a.calendar, a.email").click(function(event){\n
   event.preventDefault();\n
   showNotImplementedMessage("a#left_message");\n
 });\n
 $("a#login").click(function(event){\n
   event.preventDefault();\n
   $("div.header-left div.field input, div.main-right, div.main-left").hide();\n
   if ($("div#login_form").html() == null){\n
     $.get("WebSection_loginDialog", function(data){\n
       $("div.header-left fieldset.widget").append("<p>" + data + "</p>")\n
     });\n
   }\n
 });\n
 $("input.listbox-check-all").click(function(event){\n
  event.preventDefault();\n
  changeCheckBoxValue(true);\n
 });\n
 $("input.listbox-uncheck-all").click(function(event){\n
  event.preventDefault();\n
  changeCheckBoxValue(false);\n
 });\n
 $.getJSON("Base_getPreferencePathList", function(data){\n
   ungPreferencePath = data.preference;\n
   systemPreferencePath = data.system_preference;\n
   if ($("div#preference_dialog").html() == "") {\n
     $.get(ungPreferencePath + \'/Preference_viewHtmlStyle?editable_mode:int=1\', function(data){\n
       $("div#preference_dialog").append("<form id=\'erp5_preference\'>" + \n
                                         "<fieldset class=\'center editable\'>" + \n
                                         $(data).find(\'fieldset.center.editable\').html() +\n
                                         "</fieldset></form>");\n
     });\n
     $.get(systemPreferencePath + \'/SystemPreference_view?editable_mode:int=1\', function(data){\n
       $("div#preference_dialog").append("<form id=\'system_preference\'>" + \n
                                         "<fieldset class=\'right editable\'>" + \n
                                         $(data).find(\'fieldset.right.editable\').html() +\n
                                         "</fieldset></form>");\n
     });\n
     $.get(ungPreferencePath + \'/UNGPreference_view?editable_mode:int=1\', function(data){\n
       $("div#preference_dialog").append("<form id=\'ung_preference\'>" + \n
                                         "<fieldset class=\'center editable\'>" + \n
                                         $(data).find(\'fieldset.center.editable\').html() +\n
                                         "</fieldset></form>");\n
     });\n
  }\n
 });\n
 $("a#add_gadget").click(function(event){\n
   event.preventDefault();\n
   $("div.gadget-listbox").dialog("open");\n
 });\n
 $.getJSON("WebSection_getGadgetPathList", function(data){\n
   gadgetList = jQuery(data);\n
   gadgetList.each(function(){\n
     $("div.gadget-listbox table#gadget-table")\n
       .append($(\'<tr>\')\n
          .append($(\'<td>\')\n
            .append($(\'<input>\')\n
                .attr(\'type\', \'checkbox\')\n
                .attr(\'id\', this.id)\n
            )\n
          )\n
          .append($(\'<td>\')\n
             .append($(\'<a>\')\n
                .text(this.title)\n
             )\n
          )\n
          .append($(\'<td>\')\n
            .append($(\'<img>\')\n
               .attr(\'src\', this.image_url)\n
                .text(this.title)\n
            )\n
          )\n
       );\n
   });\n
 });\n
 return false;\n
});

]]></string> </value>
        </item>
        <item>
            <key> <string>title</string> </key>
            <value> <string></string> </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
